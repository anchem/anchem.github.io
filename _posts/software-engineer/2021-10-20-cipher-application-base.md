---
layout: post
title: 密码学应用基础
date: 2021-10-20 10:00:00
tags:
- 软件安全
- 安全基础
- 密码学
keywords: 密码学,软件安全
description: 密码学应用的基础知识
background: '/img/posts/default.jpg'
---

## 概述

现代密码学是基于**密钥**安全的，密码算法都是公开的，经权威机构认证的密码算法都是安全的，所以密码体系的安全强度取决于密钥。

因此加密系统的保密性应当建立在对密钥的保密上，而不应当取决于加密算法的保密。

```txt
正向应用：
【数据】---->{通过密钥进行加密，数据签名}---->【密文】
反向应用：
【密文】---->{通过密钥进行解密，数据验证}---->【数据】
```

### 密码算法安全强度

**安全强度**是对破解密码算法或者系统所需要的工作量的一个度量，用来衡量密码算法或密码系统的安全性。

密码算法的安全强度由**算法本身**和**密钥长度**决定。

### 密码算法分类

- 机密性
  - 对称加密
    - 流加密 RC4
    - 分组加密 DES，3DES，AES
  - 非对称加密 RSA
- 完整性/认证/防抵赖
  - Hash算法 MD5，SHA-1，SHA256
  - MAC HMAC，CMAC
  - 数字签名 RSA，DSA，ECDSA
- 密钥交换 DH，ECDH

### 密码算法的选择

| 用途 | 不安全的密码算法 | 可遗留使用的 | 推荐使用的安全密码算法|
| :--: | :--: | :--: | :--: |
| 分组加密 | Blowfish, DES, DESX, RC2, 2TDEA, Skipjack, TEA, 3DES（未遵循K1!=K2!=K3） | 3DES（K1!=K2!=K3） | AES-GCM（128bits及以上） |
| 流加密 | SEAL, CYLINK_MEK, RC4（<128bits） | RC4（128bits及以上） | AES-CTR（128bits及以上），AES-OFB（128bits及以上），Chacha20 |
| 哈希算法 | SHA0, MD2, MD4,  MD5, RIPEMD, RIPEMD-128 | SHA-1 | SHA256或以上，SHA3 |
| 非对称加密 | RSA（<2048bits） | RSA（<3072bits） | RSA（3072bits及以上） |
| 数字签名 | RSA（<2048bits）, DSA（<2048bits）, ECDSA（<224bits） | RSA（<3072bits）, DSA（<3072bits）, ECDSA（<256bits） | RSA（3072bits及以上）, DSA（3072bits及以上）, ECDSA（256bits及以上） |
| 密钥交换 | DH（<2048bits）, ECDH（<224bits） | DH（<3072bits）, ECDH（<256bits） | DH（3072bits及以上）, ECDH（256bits及以上） |

## 密码算法

### 随机数

在密码算法中，随机数发挥了重要的作用，其使用场景包括：

- 产生密钥。直接作为密钥，或作为密钥协商过程中的密钥材料。
- 产生不可预测的IV。产生不可预测的初始化向量。
- 产生盐值。盐值可以有效增加攻击的难度。

【安全随机数生成器】

- Linux下的/dev/random文件
- Windows下的CryptGenRandom
- JDK的java.security.SecureRandom

### 对称密码算法

对称密码算法，就是发送者（加密方）和接受者（解密方）使用相同的密钥。

其中，根据明文加密的方式，又分为分组加密算法和流加密算法。

- 分组加密算法：将明文分成固定长度的分组，比如128bit一组，用同一个密钥和算法对每个分组加密。
- 流加密算法：将明文按字符逐位（逐比特）与密钥流进行异或运算加密。

#### 流加密算法

流加密算法存在结构上的弱点，推荐使用AES算法的流加密工作模式，比如CTR或OFB，来替代流加密。

**【比特翻转攻击】**

由于密钥流直接与名分作用，如果密钥流泄露，则会导致加密失效。攻击者可以通过翻转密文指定比特的方式来修改内容。

**【WEP加密误用RC4】**

由于WEP协议使用了RC4进行加密，并使用CRC-32校验完整性，已成为不安全加密协议被淘汰使用。

#### 分组加密算法

分组加密将明文消息划分成固定长度的分组，每个分组使用相同的密钥和算法计算密文。对于数据长度不够的，会进行填充。

#### AES

AES，Advanced Encryption Standard，高级加密标准，也称为 Rijndael加密算法，已被广泛使用。

AES有不同的工作模式，适用于不同的加密场景和数据长度。常见推荐的如下：

- AES-GCM：适用于分组加密，安全性高。
- AES-CTR：适用于面向分组的传输，用于高速需求。
- AES-OFB：适用于噪声信道上的数据流加密传输。

#### 3DES

3DES是DES算法的扩展，加密过程执行3次DES运算。

#### 最佳实践

- CBC/CFB中所使用的IV值，必须不可预测，因此应当使用安全随机数；
- 在使用同一个密钥的情况下，不得两次使用同一个IV加密数据。

### 非对称密码算法

非对称密码算法使用2个密钥，一个公钥，一个私钥。公钥可以向所有使用者公开，而私钥需要保密。

该类算法广泛应用于密钥协商、数字签名、数字证书等安全领域。

```txt
【明文数据】---->{公钥加密}---->【密文数据】---->{私钥解密}---->【明文数据】
```

#### 密钥交换

对称加密算法解决了数据加解密的问题，而密钥交换解决了密钥传输的问题。

**【过程】**

1. 甲和乙协商密钥，甲使用`公钥乙`对通信密钥加密；
2. 乙使用`私钥乙`对密文解密，得到通信密钥

#### 数字签名

数字签名用于签发和鉴别数字信息，证明发送方是正确的发送方。其中，同时进行加密时，先签名，后加密，签名过程使用私钥，验证过程使用公钥。

**【使用过程】**

1. 甲持有`公钥（甲）`和`私钥（甲）`；
2. 乙要给甲发消息，使用`公钥（甲）`加密，甲再使用`私钥（甲）`解密，即可还原内容；
3. 甲给乙回复消息，采用**数字签名**，先用Hash函数对消息生成**摘要**；
4. 甲再对摘要通过`私钥（甲）`生成数字签名，并将数字签名附在消息后面，一起发给乙；
5. 乙收到消息后，用`公钥（甲）`解密数字签名得到摘要，可以证明消息是甲发出的；
6. 乙再对消息本身使用Hash函数，将得到的结果与摘要对比，如果一直，可证明消息未被**篡改**；

#### 数字证书

数字证书解决了公钥被篡改、仿冒的问题。

**【使用过程】**

1. 甲要发布一个数字证书。需要向证书颁布机构CA提交申请，CA会将`公钥甲`使用`私钥CA`进行签名，并生成`数字证书甲`；
2. 乙要和甲通信，获取到`数字证书甲`之后，使用`公钥CA`验证数字证书的正确性；

#### RSA算法

RSA由三位数学家提出，既可以用于数据加密，也可以用于数字签名。

- 密钥生成：生成公钥和私钥；
- 非对称加密：使用公钥加密，私钥解密；
- 数字签名：使用私钥加密摘要，公钥验签；

其中，加密和签名要使用不同的密钥对。

适用于校验频度较高，签名频度较低的场景。

#### ECC算法

ECC是基于椭圆曲线数学的加密算法，也支持数据加密和数字签名。常见的ECC算法包括ECDSA、ECDH、国密SM2

其主要优势在于可以使用更小的密钥，更小的计算量，提供相同甚至更高的安全性。适用于处理和存储能力受限的环境中。

#### DH算法

DH算法适用于密钥分发场景，可以让通信双方在完全没有对方任何预先信息的条件下通过不安全的信道协议协商双方的共享的对称密钥。

但 DH算法容易受到中间人攻击，需要签名或身份认证机制配合使用。

### Hash算法

## 密钥管理

## 密码协议
